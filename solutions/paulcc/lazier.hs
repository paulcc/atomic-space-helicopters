import Debug.Trace
import Data.List as L
import Data.Map as M

start  = (0,0)
target = (length (head problem) - 1, length problem - 1)

coords = [ (x,y) 
         | (y,row) <- zip [0..] problem
         , (x,c)   <- zip [0..] row 
         , c /= " "
         ]

problem = eg1

-- Just "DDRRDRRDRRRRRRDRDDDDDRDDRRDRRRRDDDDDDDRDDRDRRRRDX"

eg1 = [[" "," ","#"," ","#"," ","#"," ","#"," "," "," "," "," "," ","#"," ","#"," "," "," "," "," ","#"," "],
       [" "," "," ","#"," "," "," "," "," "," "," ","#","#"," ","#"," ","#"," ","#"," "," "," "," "," ","#"],
       [" "," "," "," "," "," "," "," "," "," ","#"," "," ","#"," "," "," ","#"," "," "," ","#","#","#"," "],
       [" ","#"," "," "," "," ","#"," "," "," "," "," ","#","#","#"," "," "," "," "," "," "," "," "," ","#"],
       [" "," "," ","#"," "," "," "," "," "," "," ","#","#"," "," "," ","#"," "," "," ","#"," ","#"," "," "],
       ["#"," "," "," "," "," ","#"," ","#","#"," "," ","#"," "," ","#"," "," "," "," "," ","#"," "," "," "],
       ["#"," ","#"," "," "," "," "," ","#"," ","#"," "," "," "," ","#"," "," ","#"," "," "," "," "," "," "],
       ["#"," ","#"," ","#","#","#"," "," "," ","#"," "," ","#","#"," "," "," "," ","#"," ","#"," "," "," "],
       [" "," ","#"," "," "," "," "," "," ","#"," "," ","#"," "," "," "," "," "," "," ","#"," "," "," "," "],
       [" "," ","#"," "," ","#"," ","#","#"," ","#"," "," "," "," "," "," "," ","#"," "," "," "," ","#"," "],
       [" ","#"," "," "," "," "," ","#","#"," "," "," "," ","#","#","#","#"," ","#"," "," ","#"," "," ","#"],
       [" "," "," "," "," "," "," ","#"," "," "," ","#"," "," "," ","#","#","#"," "," "," ","#"," "," "," "],
       ["#"," "," "," "," ","#"," ","#","#"," "," "," "," "," "," ","#"," "," "," "," ","#"," "," "," ","#"],
       ["#","#"," ","#","#","#","#"," "," "," "," "," "," ","#"," "," "," "," "," "," "," "," ","#","#"," "],
       [" "," "," "," "," "," ","#","#"," "," "," "," "," ","#"," "," "," ","#"," "," "," "," "," "," ","#"],
       [" ","#"," "," "," "," ","#"," ","#"," ","#"," ","#"," ","#","#"," ","#"," "," "," "," "," "," ","#"],
       [" "," "," ","#"," ","#","#"," "," "," ","#"," "," ","#","#"," "," ","#"," "," "," ","#"," ","#"," "],
       [" ","#"," ","#"," "," "," "," "," ","#"," "," ","#"," ","#","#","#","#"," "," "," ","#"," "," ","#"],
       ["#"," "," "," "," "," "," "," "," "," "," "," "," "," ","#"," "," "," "," "," "," "," "," "," ","#"],
       [" ","#"," ","#"," ","#"," ","#","#","#"," "," "," ","#"," "," "," ","#"," "," "," ","#"," ","#"," "],
       [" "," "," "," ","#"," "," "," "," "," ","#"," ","#"," "," ","#"," "," "," "," ","#"," "," "," "," "],
       [" "," "," ","#"," "," ","#"," "," "," "," "," ","#","#"," "," "," "," ","#"," "," "," "," "," "," "],
       ["#"," "," "," "," "," "," "," ","#"," "," "," ","#"," "," "," "," "," "," "," "," "," "," ","#","#"],
       [" ","#"," "," ","#"," "," ","#","#","#"," "," ","#"," ","#","#"," ","#"," ","#"," "," "," "," "," "],
       [" "," "," "," "," "," "," "," ","#"," "," "," ","#"," "," "," ","#","#"," "," "," ","#"," ","#"," "]]

-- original is unsolvable
eg2 = 
  [[" "," ","#"," ","#"," "," "," "," ","#"," "," "," ","#"," "," "," ","#"," "," "," "," "," "," "," "],
   [" "," "," ","#"," "," ","#"," ","#"," "," "," "," "," "," ","#"," "," "," "," "," "," ","#"," ","#"],
   [" "," "," ","#","#"," ","#","#"," "," "," "," "," ","#"," "," "," "," "," ","#"," "," "," "," "," "],
   [" "," "," "," "," "," "," ","#","#"," "," "," "," "," "," "," "," ","#"," "," ","#"," "," ","#"," "],
   [" "," "," "," "," ","#","#"," "," "," "," "," "," "," "," "," "," ","#"," "," "," "," ","#"," "," "],
   [" "," "," "," ","#","#"," "," "," "," "," "," "," "," ","#"," "," "," "," "," "," ","#"," "," "," "],
   [" "," "," ","X"," "," "," "," "," "," "," "," "," "," "," ","#"," "," ","#"," ","#"," ","#"," "," "],
   ["#","#","#"," ","#"," ","#"," "," "," "," "," "," "," "," "," "," "," ","#","#"," "," "," ","#"," "],
   ["#"," "," "," "," "," "," "," ","#"," "," "," ","#"," ","#"," "," "," "," "," ","#"," ","#"," "," "],
   [" "," "," "," ","#"," ","#"," "," "," "," "," ","#"," "," "," "," "," ","#"," "," "," "," ","#"," "],
   [" "," ","#","#","#"," "," "," ","#"," "," "," "," "," "," "," "," ","#"," ","#"," ","#"," "," "," "],
   [" "," "," "," "," "," "," "," ","#","#"," "," "," "," "," "," "," "," "," "," ","#"," "," "," "," "],
   [" "," "," ","#"," "," "," "," "," "," ","#"," ","#"," ","#"," "," "," "," "," ","#","#"," "," ","#"],
   [" "," "," "," "," ","#"," "," "," "," "," "," "," "," "," "," "," "," "," "," ","#"," "," "," "," "],
   [" "," ","#"," "," "," "," "," ","#","#","#"," ","#"," "," "," "," ","#"," "," "," "," "," "," ","#"],
   ["#"," "," "," ","#"," "," "," "," "," ","#","#"," "," "," "," "," ","#"," "," "," "," ","#"," "," "],
   [" "," "," "," "," "," ","#"," ","#"," ","#"," "," ","#"," "," "," "," "," "," "," "," "," "," "," "],
   [" "," ","#"," "," "," "," "," ","#"," "," "," "," "," ","#","#"," "," ","#"," ","#","#","#"," "," "],
   ["#"," "," ","#","#"," "," "," "," ","#"," "," "," ","#"," "," "," "," "," ","#","#","#"," "," "," "],
   [" "," "," "," "," "," "," "," "," "," ","#","#"," "," "," "," "," ","#"," "," "," "," "," "," "," "],
   ["#","#","#","#","#"," "," "," "," "," "," "," "," "," ","#","#","#"," ","#"," ","#"," ","#"," ","#"],
   [" ","#"," ","#"," ","#"," "," "," "," "," "," "," "," "," "," "," ","#"," "," "," "," "," ","#"," "],
   ["#"," "," "," "," "," "," ","#"," "," ","#"," "," ","#","#","#"," "," "," "," "," ","#"," "," "," "],
   [" "," ","#"," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ","#"," "," "," "," "],
   ["#"," "," "," "," ","#","#"," ","#"," "," "," "," "," "," "," "," ","#"," ","#","#"," ","#"," "," "]]



----------------------------------------

type Coord = (Int,Int)
type Path = String
type Sols = M.Map Coord (Maybe Path)

opts (x,y) = [ ('D', (x,     y + 1) )
             , ('R', (x + 1, y    ) ) 
          -- , ('U', (x    , y - 1) ) 
          -- , ('L', (x - 1, y    ) ) 
             ]

step lookup_fn pt@(x,y) 
 | pt == target          = Just "X"
 | pt `elem` coords      = Nothing 
 | Prelude.null options  = Nothing
 | otherwise             = Just (shortest_first options)
   where options = [ step:path | (step,new_pt) <- opts pt
                               , Just path <- [ lookup_fn new_pt ] ] 

thing
 = table
   where table = M.fromList [ ((x,y), step (table !?) (x,y)) 
                            | x <- [0 .. fst target]
                            , y <- [0 .. snd target] ]

t1 = thing ! (0,0)



-- should be in lib?
m !? x = M.findWithDefault Nothing x m 

-- shortest_first = sortBy (\a b -> length a `compare` length b)
shortest_first = foldr1 shortest


-- stop when one list ends...
shortest xs ys = shortest_aux xs ys (xs, ys)

shortest_aux (x:xs) (y:ys) = shortest_aux xs ys 
shortest_aux []     _      = fst
shortest_aux _      []     = snd


